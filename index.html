<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <title>Kalkulator Waris</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-color: #2c5aa0;
        --secondary-color: #f8f9fa;
        --accent-color: #28a745;
        --warning-color: #ffc107;
        --error-color: #dc3545;
        --text-dark: #2c3e50;
        --text-light: #6c757d;
        --border-color: #e9ecef;
        --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        --border-radius: 8px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: var(--text-dark);
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
        overflow: hidden;
      }

      .header {
        background: var(--primary-color);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.2em;
        margin-bottom: 10px;
        font-weight: 300;
      }

      .header p {
        opacity: 0.9;
        font-size: 1.1em;
      }

      .quran-section {
        background: var(--secondary-color);
        padding: 30px;
        border-bottom: 1px solid var(--border-color);
      }

      .quran-verse {
        text-align: center;
        margin-bottom: 20px;
      }

      .arabic-text {
        font-size: 1.8em;
        line-height: 2;
        color: var(--primary-color);
        margin-bottom: 15px;
        font-family: "Times New Roman", serif;
      }

      .translation {
        font-style: italic;
        color: var(--text-light);
        margin-bottom: 10px;
        font-size: 1.1em;
      }

      .verse-ref {
        font-weight: bold;
        color: var(--primary-color);
      }

      .reminder {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: var(--border-radius);
        padding: 20px;
        margin-top: 20px;
      }

      .reminder-icon {
        color: #856404;
        margin-right: 10px;
      }

      .form-content {
        padding: 40px;
      }

      .section-title {
        font-size: 1.4em;
        color: var(--primary-color);
        margin-bottom: 25px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--primary-color);
        display: flex;
        align-items: center;
      }

      .section-title i {
        margin-right: 10px;
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--text-dark);
        font-size: 0.95em;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid var(--border-color);
        border-radius: var(--border-radius);
        font-size: 1em;
        transition: all 0.3s ease;
        background: white;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
      }

      .form-group.disabled {
        opacity: 0.6;
      }

      .form-group.disabled input,
      .form-group.disabled select {
        background-color: #f8f9fa;
        cursor: not-allowed;
      }

      .disabled-info {
        color: var(--text-light);
        font-size: 0.85em;
        font-style: italic;
        margin-top: 5px;
        display: flex;
        align-items: center;
      }

      .disabled-info i {
        margin-right: 5px;
      }

      .btn {
        background: var(--accent-color);
        color: white;
        padding: 15px 30px;
        border: none;
        border-radius: var(--border-radius);
        font-size: 1.1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        width: 100%;
        max-width: 300px;
        margin: 30px auto 0;
      }

      .btn:hover {
        background: #218838;
        transform: translateY(-2px);
        box-shadow: var(--shadow);
      }

      .hasil {
        margin: 30px 40px;
        padding: 30px;
        background: var(--secondary-color);
        border-radius: var(--border-radius);
        border: 1px solid var(--border-color);
      }

      .hasil h3 {
        color: var(--primary-color);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
      }

      .hasil h3 i {
        margin-right: 10px;
      }

      .ahli-waris {
        background: white;
        margin: 15px 0;
        padding: 20px;
        border-radius: var(--border-radius);
        border-left: 4px solid var(--primary-color);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }

      .ahli-waris strong {
        color: var(--primary-color);
        font-size: 1.1em;
      }

      .total-section {
        background: var(--primary-color);
        color: white;
        padding: 20px;
        border-radius: var(--border-radius);
        margin-top: 20px;
        text-align: center;
      }

      .aul-warning {
        background: #fff3cd;
        border: 2px solid var(--warning-color);
        color: #856404;
        padding: 20px;
        border-radius: var(--border-radius);
        margin: 20px 0;
        display: flex;
        align-items: flex-start;
        gap: 15px;
      }

      .aul-warning i {
        font-size: 1.5em;
        margin-top: 2px;
        color: var(--warning-color);
      }

      .aul-calculation {
        background: #2c5aa0;
        color: white;
        padding: 25px;
        border-radius: var(--border-radius);
        margin: 20px 0;
        text-align: center;
      }

      .aul-calculation h4 {
        margin-bottom: 15px;
        font-size: 1.3em;
      }

      .aul-formula {
        background: rgba(255, 255, 255, 0.2);
        padding: 15px;
        border-radius: var(--border-radius);
        margin: 10px 0;
        font-family: "Courier New", monospace;
        font-size: 1.1em;
      }

      .error {
        background: #f8d7da;
        color: #721c24;
        padding: 15px;
        border-radius: var(--border-radius);
        margin: 20px 40px;
        display: flex;
        align-items: center;
      }

      .error i {
        margin-right: 10px;
      }

      .footer {
        background: var(--text-dark);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .developer-info {
        margin-bottom: 15px;
      }

      .developer-name {
        font-size: 1.2em;
        font-weight: 600;
        margin-bottom: 10px;
      }

      .social-links {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 15px;
      }

      .social-links a {
        color: white;
        font-size: 1.5em;
        transition: all 0.3s ease;
      }

      .social-links a:hover {
        color: var(--accent-color);
        transform: scale(1.2);
      }

      .copyright {
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #495057;
        opacity: 0.8;
        font-size: 0.9em;
      }

      @media (max-width: 768px) {
        .container {
          margin: 10px;
        }

        .form-content {
          padding: 20px;
        }

        .header {
          padding: 20px;
        }

        .header h1 {
          font-size: 1.8em;
        }

        .arabic-text {
          font-size: 1.4em;
        }

        .form-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1>Kalkulator Pembagian Waris</h1>
      </div>

      <!-- Quran Section -->
      <div class="quran-section">
        <div class="quran-verse">
          <div class="arabic-text">
            يُوصِيكُمُ اللَّهُ فِي أَوْلَادِكُمْ ۖ لِلذَّكَرِ مِثْلُ حَظِّ
            الْأُنثَيَيْنِ
          </div>
          <div class="translation">
            "Allah mensyariatkan bagimu tentang (pembagian pusaka untuk)
            anak-anakmu. Yaitu bahagian seorang anak lelaki sama dengan bahagian
            dua orang anak perempuan."
          </div>
          <div class="verse-ref">- QS. An-Nisa: 11</div>
        </div>

        <div class="reminder">
          <i class="fas fa-info-circle reminder-icon"></i>
          <strong>Catatan Penting:</strong> Pembagian waris dalam Islam adalah
          ketentuan yang telah ditetapkan oleh Allah SWT dalam Al-Qur'an dan
          merupakan bagian dari syariat Islam yang wajib dilaksanakan.
          <br /><br />
          Kalkulator ini dibuat untuk membantu memahami perhitungan dasar, namun
          untuk kasus yang kompleks, disarankan untuk berkonsultasi dengan ulama
          atau ahli waris yang kompeten.
        </div>
      </div>

      <!-- Form -->
      <div class="form-content">
        <form id="warisForm">
          <div class="section-title">
            <i class="fas fa-user"></i>
            Data Pewaris
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label
                ><i class="fas fa-venus-mars"></i> Jenis Kelamin Pewaris:</label
              >
              <select id="jenisKelaminPewaris">
                <option value="laki-laki">Laki-laki</option>
                <option value="perempuan">Perempuan</option>
              </select>
            </div>

            <div class="form-group">
              <label
                ><i class="fas fa-coins"></i> Total Harta Warisan (Rp):</label
              >
              <input
                type="number"
                id="totalHarta"
                placeholder="Contoh: 1000000"
                required
              />
            </div>
          </div>

          <div class="section-title">
            <i class="fas fa-users"></i>
            Ahli Waris yang Masih Hidup
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label><i class="fas fa-heart"></i> Suami/Istri:</label>
              <select id="pasangan">
                <option value="tidak">Tidak Ada</option>
                <option value="suami">Suami</option>
                <option value="istri">Istri</option>
              </select>
            </div>

            <div class="form-group">
              <label><i class="fas fa-child"></i> Jumlah Anak Laki-laki:</label>
              <input type="number" id="anakLaki" min="0" value="0" />
            </div>

            <div class="form-group">
              <label><i class="fas fa-child"></i> Jumlah Anak Perempuan:</label>
              <input type="number" id="anakPerempuan" min="0" value="0" />
            </div>

            <div class="form-group">
              <label><i class="fas fa-male"></i> Ayah:</label>
              <select id="ayah">
                <option value="tidak">Tidak Ada</option>
                <option value="ada">Ada</option>
              </select>
            </div>

            <div class="form-group">
              <label><i class="fas fa-female"></i> Ibu:</label>
              <select id="ibu">
                <option value="tidak">Tidak Ada</option>
                <option value="ada">Ada</option>
              </select>
            </div>

            <div class="form-group" id="groupSaudaraLaki">
              <label
                ><i class="fas fa-user-friends"></i> Saudara Laki-laki
                Sekandung:</label
              >
              <input type="number" id="saudaraLaki" min="0" value="0" />
            </div>

            <div class="form-group" id="groupSaudaraPerempuan">
              <label
                ><i class="fas fa-user-friends"></i> Saudara Perempuan
                Sekandung:</label
              >
              <input type="number" id="saudaraPerempuan" min="0" value="0" />
            </div>

            <div class="form-group" id="groupSaudaraLakiSeayah">
              <label
                ><i class="fas fa-user-friends"></i> Saudara Laki-laki
                Seayah:</label
              >
              <input type="number" id="saudaraLakiSeayah" min="0" value="0" />
            </div>

            <div class="form-group" id="groupSaudaraPerempuanSeayah">
              <label
                ><i class="fas fa-user-friends"></i> Saudara Perempuan
                Seayah:</label
              >
              <input
                type="number"
                id="saudaraPerempuanSeayah"
                min="0"
                value="0"
              />
            </div>
          </div>

          <button type="button" class="btn" onclick="hitungWaris()">
            <i class="fas fa-calculator"></i>
            Hitung Pembagian Waris
          </button>
        </form>
      </div>

      <!-- Results -->
      <div id="hasil" class="hasil" style="display: none">
        <h3><i class="fas fa-chart-pie"></i> Hasil Pembagian Waris</h3>
        <div id="hasilDetail"></div>
      </div>

      <!-- Error -->
      <div id="error" class="error" style="display: none">
        <i class="fas fa-exclamation-triangle"></i>
        <span id="errorMessage"></span>
      </div>

      <!-- Footer -->
      <div class="footer">
        <div class="developer-info">
          <div class="developer-name">
            Developed by Yusma Rahman<br />
            <small><i> | Junior Web Developer |</i></small>
          </div>

          <div class="social-links">
            <a
              href="https://github.com/yusma1122"
              target="_blank"
              title="GitHub"
            >
              <i class="fab fa-github"></i>
            </a>
            <a
              href="https://www.linkedin.com/in/yusmarahman09/"
              target="_blank"
              title="LinkedIn"
            >
              <i class="fab fa-linkedin"></i>
            </a>
          </div>
        </div>
        <div class="copyright">
          © 2025 Kalkulator Waris <br />Dibuat untuk membantu umat dalam
          memahami pembagian waris menurut syariat Islam.
        </div>
      </div>
    </div>

    <script>
      // Function untuk update status form berdasarkan kondisi hijab
      function updateFormStatus() {
        const ayah = document.getElementById("ayah").value;
        const anakLaki =
          parseInt(document.getElementById("anakLaki").value) || 0;
        const anakPerempuan =
          parseInt(document.getElementById("anakPerempuan").value) || 0;

        // Saudara terhalang jika ada ayah atau ada anak
        const saudaraTerhalang =
          ayah === "ada" || anakLaki > 0 || anakPerempuan > 0;

        // Update status form saudara
        updateGroupStatus(
          "groupSaudaraLaki",
          saudaraTerhalang,
          "Terhalang oleh keberadaan ayah/anak"
        );
        updateGroupStatus(
          "groupSaudaraPerempuan",
          saudaraTerhalang,
          "Terhalang oleh keberadaan ayah/anak"
        );
        updateGroupStatus(
          "groupSaudaraLakiSeayah",
          saudaraTerhalang,
          "Terhalang oleh keberadaan ayah/anak"
        );
        updateGroupStatus(
          "groupSaudaraPerempuanSeayah",
          saudaraTerhalang,
          "Terhalang oleh keberadaan ayah/anak"
        );
      }

      function updateGroupStatus(groupId, disabled, reason) {
        const group = document.getElementById(groupId);
        const input = group.querySelector("input");

        if (disabled) {
          group.classList.add("disabled");
          input.disabled = true;
          input.value = 0;

          // Tambahkan info mengapa terhalang
          let infoDiv = group.querySelector(".disabled-info");
          if (!infoDiv) {
            infoDiv = document.createElement("div");
            infoDiv.className = "disabled-info";
            group.appendChild(infoDiv);
          }
          infoDiv.innerHTML = `<i class="fas fa-ban"></i> ${reason}`;
        } else {
          group.classList.remove("disabled");
          input.disabled = false;

          // Hapus info
          const infoDiv = group.querySelector(".disabled-info");
          if (infoDiv) {
            infoDiv.remove();
          }
        }
      }

      // Event listeners untuk update form secara real-time
      document
        .getElementById("ayah")
        .addEventListener("change", updateFormStatus);
      document
        .getElementById("anakLaki")
        .addEventListener("input", updateFormStatus);
      document
        .getElementById("anakPerempuan")
        .addEventListener("input", updateFormStatus);

      // Jalankan sekali saat halaman dimuat
      updateFormStatus();

      // Fungsi untuk mencari KPK (Kelipatan Persekutuan Kecil)
      function gcd(a, b) {
        return b === 0 ? a : gcd(b, a % b);
      }

      function lcm(a, b) {
        return (a * b) / gcd(a, b);
      }

      function lcmArray(arr) {
        return arr.reduce((acc, val) => lcm(acc, val), 1);
      }

      // Fungsi untuk menghitung al-'aul
      function hitungAul(bagianFaraid) {
        // Hitung penyebut persekutuan terkecil
        const penyebuts = bagianFaraid.map((b) => b.penyebut);
        const kpk = lcmArray(penyebuts);

        // Konversi semua bagian ke penyebut yang sama
        let totalPembilang = 0;
        const bagianKonversi = bagianFaraid.map((bagian) => {
          const faktor = kpk / bagian.penyebut;
          const pembilangBaru = bagian.pembilang * faktor;
          totalPembilang += pembilangBaru;
          return {
            ...bagian,
            pembilangAwal: bagian.pembilang,
            penyebutAwal: bagian.penyebut,
            pembilang: pembilangBaru,
            penyebut: kpk,
          };
        });

        // Cek apakah terjadi al-'aul
        const isAul = totalPembilang > kpk;

        return {
          isAul,
          kpk,
          totalPembilang,
          bagianSetelahAul: bagianKonversi,
          faktorAul: isAul ? totalPembilang / kpk : 1,
        };
      }

      function hitungWaris() {
        const totalHarta = parseInt(
          document.getElementById("totalHarta").value
        );
        const pasangan = document.getElementById("pasangan").value;
        const anakLaki =
          parseInt(document.getElementById("anakLaki").value) || 0;
        const anakPerempuan =
          parseInt(document.getElementById("anakPerempuan").value) || 0;
        const ayah = document.getElementById("ayah").value;
        const ibu = document.getElementById("ibu").value;
        const saudaraLaki =
          parseInt(document.getElementById("saudaraLaki").value) || 0;
        const saudaraPerempuan =
          parseInt(document.getElementById("saudaraPerempuan").value) || 0;
        const saudaraLakiSeayah =
          parseInt(document.getElementById("saudaraLakiSeayah").value) || 0;
        const saudaraPerempuanSeayah =
          parseInt(document.getElementById("saudaraPerempuanSeayah").value) ||
          0;

        // Validasi input
        if (!totalHarta || totalHarta <= 0) {
          showError("Masukkan total harta yang valid");
          return;
        }

        hideError();

        let bagianFaraid = [];
        let pembagian = [];
        let sisaHarta = totalHarta;

        // Menentukan bagian-bagian waris berdasarkan mazhab Hanafi

        // 1. Bagian Suami/Istri
        if (pasangan === "suami") {
          if (anakLaki > 0 || anakPerempuan > 0) {
            // Suami mendapat 1/4 jika ada anak
            bagianFaraid.push({
              ahli: "Suami",
              pembilang: 1,
              penyebut: 4,
              bagianStr: "1/4",
            });
          } else {
            // Suami mendapat 1/2 jika tidak ada anak
            bagianFaraid.push({
              ahli: "Suami",
              pembilang: 1,
              penyebut: 2,
              bagianStr: "1/2",
            });
          }
        } else if (pasangan === "istri") {
          if (anakLaki > 0 || anakPerempuan > 0) {
            // Istri mendapat 1/8 jika ada anak
            bagianFaraid.push({
              ahli: "Istri",
              pembilang: 1,
              penyebut: 8,
              bagianStr: "1/8",
            });
          } else {
            // Istri mendapat 1/4 jika tidak ada anak
            bagianFaraid.push({
              ahli: "Istri",
              pembilang: 1,
              penyebut: 4,
              bagianStr: "1/4",
            });
          }
        }

        // 2. Bagian Ayah
        if (ayah === "ada") {
          if (anakLaki > 0 || anakPerempuan > 0) {
            // Ayah mendapat 1/6 jika ada anak
            bagianFaraid.push({
              ahli: "Ayah",
              pembilang: 1,
              penyebut: 6,
              bagianStr: "1/6",
            });
          }
          // Jika tidak ada anak, ayah mendapat sisa sebagai asabah (akan dihitung terpisah)
        }

        // 3. Bagian Ibu
        if (ibu === "ada") {
          if (
            anakLaki > 0 ||
            anakPerempuan > 0 ||
            saudaraLaki +
              saudaraPerempuan +
              saudaraLakiSeayah +
              saudaraPerempuanSeayah >=
              2
          ) {
            // Ibu mendapat 1/6 jika ada anak atau 2+ saudara kandung/seayah
            bagianFaraid.push({
              ahli: "Ibu",
              pembilang: 1,
              penyebut: 6,
              bagianStr: "1/6",
            });
          } else {
            // Ibu mendapat 1/3 jika tidak ada anak dan kurang dari 2 saudara
            bagianFaraid.push({
              ahli: "Ibu",
              pembilang: 1,
              penyebut: 3,
              bagianStr: "1/3",
            });
          }
        }

        // 4. Bagian Anak Perempuan (hanya jika tidak ada anak laki-laki)
        if (anakPerempuan > 0 && anakLaki === 0) {
          if (anakPerempuan === 1) {
            bagianFaraid.push({
              ahli: `Anak Perempuan (1 orang)`,
              pembilang: 1,
              penyebut: 2,
              bagianStr: "1/2",
              jumlahOrang: 1,
            });
          } else {
            bagianFaraid.push({
              ahli: `Anak Perempuan (${anakPerempuan} orang)`,
              pembilang: 2,
              penyebut: 3,
              bagianStr: "2/3",
              jumlahOrang: anakPerempuan,
            });
          }
        }

        // 5. Bagian Saudara Perempuan (jika tidak ada anak dan saudara laki-laki)
        if (
          anakLaki === 0 &&
          anakPerempuan === 0 &&
          ayah === "tidak" &&
          saudaraLaki === 0
        ) {
          if (saudaraPerempuan === 1) {
            bagianFaraid.push({
              ahli: "Saudara Perempuan Kandung (1 orang)",
              pembilang: 1,
              penyebut: 2,
              bagianStr: "1/2",
              jumlahOrang: 1,
            });
          } else if (saudaraPerempuan > 1) {
            bagianFaraid.push({
              ahli: `Saudara Perempuan Kandung (${saudaraPerempuan} orang)`,
              pembilang: 2,
              penyebut: 3,
              bagianStr: "2/3",
              jumlahOrang: saudaraPerempuan,
            });
          }
        }

        // Hitung al-'aul jika ada bagian faraid
        let hasilAul = null;
        if (bagianFaraid.length > 0) {
          hasilAul = hitungAul(bagianFaraid);
        }

        // Konversi bagian faraid ke pembagian riil
        if (hasilAul && bagianFaraid.length > 0) {
          hasilAul.bagianSetelahAul.forEach((bagian) => {
            let nilaiSebenarnya;

            if (hasilAul.isAul) {
              // Jika terjadi al-'aul, hitung berdasarkan proporsi yang disesuaikan
              nilaiSebenarnya =
                (bagian.pembilang / hasilAul.totalPembilang) * totalHarta;
            } else {
              // Jika tidak ada al-'aul, hitung normal
              nilaiSebenarnya =
                (bagian.pembilang / bagian.penyebut) * totalHarta;
            }

            const itemPembagian = {
              ahli: bagian.ahli,
              bagian: bagian.bagianStr,
              bagianAsli: `${bagian.pembilangAwal}/${bagian.penyebutAwal}`,
              bagianSetelahAul: hasilAul.isAul
                ? `${bagian.pembilang}/${hasilAul.totalPembilang}`
                : bagian.bagianStr,
              jumlah: nilaiSebenarnya,
              isAul: hasilAul.isAul,
            };

            if (bagian.jumlahOrang) {
              itemPembagian.perOrang = nilaiSebenarnya / bagian.jumlahOrang;
              itemPembagian.jumlahOrang = bagian.jumlahOrang;
            }

            pembagian.push(itemPembagian);
            sisaHarta -= nilaiSebenarnya;
          });
        }

        // Bagian Asabah (yang mendapat sisa)
        if (sisaHarta > 1) {
          // Toleransi untuk pembulatan
          if (anakLaki > 0) {
            // Anak laki-laki sebagai asabah bersama anak perempuan
            const totalBagianAnak = anakLaki * 2 + anakPerempuan;
            const bagianPerSatu = sisaHarta / totalBagianAnak;

            if (anakLaki > 0) {
              const bagianAnakLaki = bagianPerSatu * 2 * anakLaki;
              const bagianPerAnakLaki = bagianAnakLaki / anakLaki;
              pembagian.push({
                ahli: `Anak Laki-laki (${anakLaki} orang)`,
                bagian: "Asabah (2x bagian anak perempuan)",
                jumlah: bagianAnakLaki,
                perOrang: bagianPerAnakLaki,
                jumlahOrang: anakLaki,
                isAsabah: true,
              });
            }

            if (anakPerempuan > 0 && anakLaki > 0) {
              const bagianAnakPerempuan = bagianPerSatu * anakPerempuan;
              const bagianPerAnakPerempuan =
                bagianAnakPerempuan / anakPerempuan;
              pembagian.push({
                ahli: `Anak Perempuan (${anakPerempuan} orang) - Asabah`,
                bagian: "Asabah (1x bagian)",
                jumlah: bagianAnakPerempuan,
                perOrang: bagianPerAnakPerempuan,
                jumlahOrang: anakPerempuan,
                isAsabah: true,
              });
            }
            sisaHarta = 0;
          } else if (ayah === "ada" && anakLaki === 0 && anakPerempuan === 0) {
            // Ayah sebagai asabah jika tidak ada anak
            pembagian.push({
              ahli: "Ayah",
              bagian: "Asabah (sisa)",
              jumlah: sisaHarta,
              isAsabah: true,
            });
            sisaHarta = 0;
          } else if (
            saudaraLaki > 0 &&
            ayah === "tidak" &&
            anakLaki === 0 &&
            anakPerempuan === 0
          ) {
            // Saudara laki-laki kandung sebagai asabah
            const bagianPerSaudara = sisaHarta / saudaraLaki;
            pembagian.push({
              ahli: `Saudara Laki-laki Kandung (${saudaraLaki} orang)`,
              bagian: "Asabah (sisa)",
              jumlah: sisaHarta,
              perOrang: bagianPerSaudara,
              jumlahOrang: saudaraLaki,
              isAsabah: true,
            });
            sisaHarta = 0;
          } else if (
            saudaraLakiSeayah > 0 &&
            ayah === "tidak" &&
            anakLaki === 0 &&
            anakPerempuan === 0 &&
            saudaraLaki === 0 &&
            saudaraPerempuan === 0
          ) {
            // Saudara laki-laki seayah sebagai asabah
            const bagianPerSaudara = sisaHarta / saudaraLakiSeayah;
            pembagian.push({
              ahli: `Saudara Laki-laki Seayah (${saudaraLakiSeayah} orang)`,
              bagian: "Asabah (sisa)",
              jumlah: sisaHarta,
              perOrang: bagianPerSaudara,
              jumlahOrang: saudaraLakiSeayah,
              isAsabah: true,
            });
            sisaHarta = 0;
          } else if (sisaHarta > 1) {
            // Baitul Mal
            pembagian.push({
              ahli: "Baitul Mal (Kas Negara)",
              bagian: "Sisa",
              jumlah: sisaHarta,
              isAsabah: true,
            });
          }
        }

        tampilkanHasil(pembagian, totalHarta, hasilAul);
      }

      function tampilkanHasil(pembagian, totalHarta, hasilAul) {
        const hasilDiv = document.getElementById("hasilDetail");
        let html = `
                <div class="total-section">
                    <h4><i class="fas fa-wallet"></i> Total Harta Warisan</h4>
                    <div style="font-size: 1.5em; font-weight: bold;">Rp ${totalHarta.toLocaleString(
                      "id-ID"
                    )}</div>
                </div>
            `;

        // Tampilkan informasi al-'aul jika terjadi
        if (hasilAul && hasilAul.isAul) {
          html += `
                    <div class="aul-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            <strong>Terjadi Al-'Aul (عول)</strong><br>
                            Total bagian fara'id melebihi harta warisan. Sistem al-'aul akan mengurangi semua bagian secara proporsional sesuai syariat Islam.
                        </div>
                    </div>

                    <div class="aul-calculation">
                        <h4><i class="fas fa-calculator"></i> Perhitungan Al-'Aul</h4>
                        <div class="aul-formula">
                            KPK Penyebut: ${hasilAul.kpk}<br>
                            Total Pembilang: ${hasilAul.totalPembilang}<br>
                            Faktor Al-'Aul: ${hasilAul.totalPembilang}/${
            hasilAul.kpk
          } = ${hasilAul.faktorAul.toFixed(4)}
                        </div>
                        <p style="margin-top: 15px; font-size: 0.95em; opacity: 0.9;">
                            Semua bagian fara'id dikurangi dengan faktor ${hasilAul.faktorAul.toFixed(
                              4
                            )} untuk menyesuaikan dengan total harta yang tersedia.
                        </p>
                    </div>
                `;
        }

        let totalPembagian = 0;
        pembagian.forEach((item) => {
          const aulInfo =
            item.isAul && hasilAul && hasilAul.isAul
              ? `<div style="color: #856404; font-size: 0.85em; margin-top: 5px;">
                <i class="fas fa-arrow-right"></i> Bagian asli: ${item.bagianAsli} → Setelah al-'aul: ${item.bagianSetelahAul}
            </div>`
              : "";

          html += `
                    <div class="ahli-waris" style="${
                      item.isAul && hasilAul && hasilAul.isAul
                        ? "border-left-color: var(--warning-color);"
                        : ""
                    }">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <strong><i class="fas fa-user"></i> ${
                              item.ahli
                            }</strong>
                            <span style="background: ${
                              item.isAsabah
                                ? "#17a2b8"
                                : item.isAul && hasilAul && hasilAul.isAul
                                ? "var(--warning-color)"
                                : "var(--primary-color)"
                            }; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8em;">
                                ${item.bagian}${
            item.isAsabah ? " (Asabah)" : ""
          }
                            </span>
                        </div>
                        ${aulInfo}
                        <div style="color: var(--text-light); margin-bottom: 8px;">
                            <i class="fas fa-coins"></i> Jumlah Total: <strong style="color: var(--accent-color);">Rp ${item.jumlah.toLocaleString(
                              "id-ID"
                            )}</strong>
                        </div>
                        ${
                          item.perOrang
                            ? `
                            <div style="color: var(--text-light); font-size: 0.9em;">
                                <i class="fas fa-user-circle"></i> Per Orang: <strong>Rp ${item.perOrang.toLocaleString(
                                  "id-ID"
                                )}</strong>
                            </div>
                        `
                            : ""
                        }
                    </div>
                `;
          totalPembagian += item.jumlah;
        });

        html += `
                <div style="background: white; padding: 20px; border-radius: var(--border-radius); border: 2px solid var(--accent-color); margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <strong style="color: var(--text-dark);"><i class="fas fa-calculator"></i> Total yang Dibagikan:</strong>
                        <strong style="color: var(--accent-color); font-size: 1.2em;">Rp ${totalPembagian.toLocaleString(
                          "id-ID"
                        )}</strong>
                    </div>
                </div>
            `;

        const selisih = Math.abs(totalPembagian - totalHarta);
        if (selisih > 1) {
          html += `
                    <div style="background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: var(--border-radius); margin-top: 15px;">
                        <strong style="color: #856404;"><i class="fas fa-exclamation-triangle"></i> Selisih: Rp ${selisih.toLocaleString(
                          "id-ID"
                        )}</strong>
                        <div style="font-size: 0.9em; margin-top: 5px;">
                            ${
                              hasilAul && hasilAul.isAul
                                ? "Selisih kecil ini normal dalam perhitungan al-'aul karena pembulatan."
                                : "Selisih mungkin terjadi karena pembulatan dalam perhitungan."
                            }
                        </div>
                    </div>
                `;
        }

        hasilDiv.innerHTML = html;
        document.getElementById("hasil").style.display = "block";

        // Smooth scroll to results
        document.getElementById("hasil").scrollIntoView({ behavior: "smooth" });
      }

      function showError(message) {
        const errorDiv = document.getElementById("error");
        const errorMessage = document.getElementById("errorMessage");
        errorMessage.textContent = message;
        errorDiv.style.display = "flex";
        document.getElementById("hasil").style.display = "none";

        // Smooth scroll to error
        errorDiv.scrollIntoView({ behavior: "smooth" });
      }

      function hideError() {
        document.getElementById("error").style.display = "none";
      }

      // Add smooth scrolling for form submission
      document
        .getElementById("totalHarta")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            hitungWaris();
          }
        });
    </script>
  </body>
</html>
